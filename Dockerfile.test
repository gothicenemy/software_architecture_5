# Використовуємо офіційний образ Golang як базовий для збірки
FROM golang:1.24 AS build

# Встановлюємо робочу директорію всередині контейнера
WORKDIR /app

# Копіюємо файли go.mod та go.sum для завантаження залежностей
COPY go.mod ./
RUN go mod download
RUN go mod verify

# Копіюємо весь код проекту в контейнер
COPY . .

# Встановлюємо змінну оточення, щоб активувати інтеграційні тести
ENV INTEGRATION_TEST=true

# Збираємо тести (необов'язково, але може виявити помилки компіляції раніше)
# RUN go test -c ./integration/... -o /app/integration.test

# Команда за замовчуванням для запуску тестів
# -v для детального виводу
# -count=1 щоб уникнути кешування результатів тестів між запусками
# ./integration/... запустить всі тести в пакеті integration та його підпакетах
ENTRYPOINT ["go", "test", "-v", "-count=1", "./integration/..."]
